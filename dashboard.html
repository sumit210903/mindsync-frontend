<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MindSync - Wellness Tracker Dashboard</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Quicksand', sans-serif; }
    body {
      background: linear-gradient(135deg, #dff6f0, #b9e5e8, #a7c7e7);
      color: #2c3e50;
      min-height: 100vh;
      display: flex; flex-direction: column;
    }

    /* Navbar */
    nav {
      background: rgba(255, 255, 255, 0.9);
      padding: 15px 8%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      flex-wrap: wrap;
    }
    nav h1 { font-size: 26px; color: #006c59; display: flex; align-items: center; gap: 8px; }
    nav h1 i { color: #006c59; }
    nav ul { list-style: none; display: flex; gap: 25px; flex-wrap: wrap; }
    nav ul li a { color: #2c3e50; text-decoration: none; font-weight: 600; transition: 0.3s; }
    nav ul li a:hover { color: #006c59; }
    .menu-toggle { display: none; font-size: 22px; cursor: pointer; }

    @media (max-width: 768px) {
      .menu-toggle { display: block; }
      nav ul { display: none; width: 100%; flex-direction: column; gap: 15px; margin-top: 10px; }
      nav ul.show { display: flex; }
    }

    /* Profile */
    .profile { text-align: center; padding: 40px 8% 20px; }
    .profile img {
      width: 100px; height: 100px;
      border-radius: 50%; object-fit: cover;
      border: 3px solid #006c59;
    }
    .profile h2 { color: #006c59; margin-top: 10px; }
    .profile p { color: #555; }

    /* Dashboard Grid */
    .dashboard {
      padding: 30px 8%;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
    }

    .card {
      background: #fff;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
      transition: transform 0.3s;
      text-align: center;
    }
    .card:hover { transform: translateY(-6px); }
    .card h3 { color: #006c59; margin-bottom: 8px; }
    .card p { color: #555; font-size: 15px; }
    .card i { font-size: 34px; color: #006c59; margin-bottom: 12px; }

    .input-section {
      margin-top: 12px;
      display: flex;
      justify-content: center;
      gap: 8px;
    }
    .input-section input {
      width: 60%;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .input-section button {
      background: #006c59;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .input-section button:hover { background: #004c3e; }

    canvas { margin-top: 10px; height: 180px !important; }

    footer {
      background: #006c59;
      color: #fff;
      text-align: center;
      padding: 18px;
      margin-top: auto;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <h1><i class="fa-solid fa-brain"></i> MindSync</h1>
    <div class="menu-toggle"><i class="fa-solid fa-bars"></i></div>
    <ul>
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="wellness.html">Wellness</a></li>
      <li><a href="profile.html">Profile</a></li>
      <li><a href="logout.html">Logout</a></li>
    </ul>
  </nav>

  <!-- Profile -->
  <section class="profile">
    <img id="profilePic" src="images/default-avatar.png" alt="User" />
    <h2 id="userName">Loading...</h2>
    <p>Welcome back! Hereâ€™s your latest wellness progress ðŸŒ¿</p>
  </section>

  <!-- Dashboard -->
  <section class="dashboard">
    <div class="card">
      <i class="fa-solid fa-dumbbell"></i>
      <h3>Fitness Tracker</h3>
      <p>Minutes exercised this week</p>
      <div class="input-section">
        <input id="fitnessInput" type="number" placeholder="Add minutes" />
        <button onclick="updateChart('fitness')">Add</button>
      </div>
      <canvas id="fitnessChart"></canvas>
    </div>

    <div class="card">
      <i class="fa-solid fa-utensils"></i>
      <h3>Nutrition Tracker</h3>
      <p>Calories consumed per day</p>
      <div class="input-section">
        <input id="nutritionInput" type="number" placeholder="Add calories" />
        <button onclick="updateChart('nutrition')">Add</button>
      </div>
      <canvas id="nutritionChart"></canvas>
    </div>

    <div class="card">
      <i class="fa-solid fa-brain"></i>
      <h3>Mental Health Tracker</h3>
      <p>Daily mood ratings (1â€“10)</p>
      <div class="input-section">
        <input id="mentalInput" type="number" placeholder="Rate mood" min="1" max="10" />
        <button onclick="updateChart('mental')">Add</button>
      </div>
      <canvas id="mentalChart"></canvas>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 MindSync | Empowering Wellness Through Synergy ðŸŒ¿</p>
  </footer>

  <script>
    const menuToggle = document.querySelector('.menu-toggle');
    const navLinks = document.querySelector('nav ul');
    menuToggle.addEventListener('click', () => navLinks.classList.toggle('show'));

    let fitnessData = [30, 45, 50, 60, 40];
    let nutritionData = [2000, 1800, 2200, 2100, 1900];
    let mentalData = [7, 8, 6, 9, 8];

    const token = localStorage.getItem("token");
    const baseURL = "https://mindsync-backend.onrender.com/api/dashboard";

    // Charts
    let fitnessChart, nutritionChart, mentalChart;

    async function loadDashboard() {
      try {
        const res = await fetch(baseURL, {
          headers: { "Authorization": `Bearer ${token}` },
        });
        const result = await res.json();

        if (result.success) {
          const { name, profilePic, fitness, nutrition, mentalHealth } = result.data;
          document.getElementById("userName").textContent = name;
          document.getElementById("profilePic").src = profilePic;
          fitnessData = fitness;
          nutritionData = nutrition;
          mentalData = mentalHealth;
        }

        initCharts();
      } catch (err) {
        console.error("Error fetching data:", err);
        initCharts();
      }
    }

    function initCharts() {
      const labels = ["Mon", "Tue", "Wed", "Thu", "Fri"];

      fitnessChart = new Chart(document.getElementById("fitnessChart"), {
        type: "line",
        data: { labels, datasets: [{ label: "Minutes", data: fitnessData, borderColor: "#006c59", fill: false }] },
        options: { responsive: true }
      });

      nutritionChart = new Chart(document.getElementById("nutritionChart"), {
        type: "bar",
        data: { labels, datasets: [{ label: "Calories", data: nutritionData, backgroundColor: "#74ebd5" }] },
        options: { responsive: true }
      });

      mentalChart = new Chart(document.getElementById("mentalChart"), {
        type: "pie",
        data: { labels, datasets: [{ data: mentalData, backgroundColor: ["#dff6f0","#b9e5e8","#a7c7e7","#80d0c7","#74ebd5"] }] },
        options: { responsive: true }
      });
    }

    function updateChart(type) {
      const input = document.getElementById(`${type}Input`);
      const value = parseInt(input.value);
      if (!value) return alert("Please enter a valid number");

      let chart, dataArray;
      if (type === 'fitness') { chart = fitnessChart; dataArray = fitnessData; }
      if (type === 'nutrition') { chart = nutritionChart; dataArray = nutritionData; }
      if (type === 'mental') { chart = mentalChart; dataArray = mentalData; }

      dataArray.push(value);
      if (dataArray.length > 7) dataArray.shift();
      chart.data.datasets[0].data = dataArray;
      chart.update();
      input.value = "";
      localStorage.setItem(type + "Data", JSON.stringify(dataArray));
    }

    window.onload = loadDashboard;
  </script>
</body>
</html>
